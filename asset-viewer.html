<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JAM Maintenance Team Viewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
  
  <style>
    /* ------------------------------------------------------------------------------------------------
     * ğŸ¨ CSS Variables & Base Styles - ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ« Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
     * ------------------------------------------------------------------------------------------------ */
    :root{
      /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
      --primary: #2563eb;        /* Ø£Ø²Ø±Ù‚ Ø£Ø³Ø§Ø³ÙŠ */
      --primary-dark: #1e40af;
      --primary-light: #3b82f6;
      --success: #10b981;        /* Ø£Ø®Ø¶Ø± */
      --warning: #f59e0b;        /* Ø£ØµÙØ± */
      --danger: #ef4444;         /* Ø£Ø­Ù…Ø± */
      --card-bg: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      
      /* Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„Ø²ÙˆØ§ÙŠØ§ */
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
      --radius: 12px;
      --radius-lg: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header Card */
    .header-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(255, 255, 255, 0.3);
      display: flex;
      justify-content: center; 
      align-items: center;
      min-height: 120px; 
    }

    .combined-logo-wrapper {
        width: 100%;
        max-width: 550px; 
        height: auto;
        display: flex;
        justify-content: center;
    }

    .combined-logo-wrapper img {
        width: 100%;
        height: auto;
        object-fit: contain;
    }
    
    /* Loading & Error States */
    .state-box {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 60px 30px;
      text-align: center;
      box-shadow: var(--shadow-xl);
      display: flex; 
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .loader {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid rgba(37, 99, 235, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Main Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
      animation: fadeIn 0.5s ease;
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        order: -1;
      }
    }

    /* Main Panel & Status Badge */
    .main-panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: var(--shadow-xl);
    }

    .asset-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
      padding-bottom: 24px;
      border-bottom: 2px solid var(--border);
      margin-bottom: 24px;
    }

    /* âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø« âœ… */
    .asset-title {
      font-size: 28px;
      font-weight: 900;
      color: var(--primary-dark);
      flex: 1;
      min-width: 200px;
    }

    /* ---------------------- Sidebar - Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ---------------------- */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .image-card, .actions-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow-xl);
    }
    
    /* ---------------------- Device Units Box (Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©) ---------------------- */
    .device-units-box {
        padding: 0 0 16px 0;
        margin-bottom: 16px;
        border-bottom: 1px dashed var(--border);
    }

    .device-unit-group {
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .device-unit-group:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .unit-label {
        font-size: 16px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 4px;
    }

    .unit-value {
        font-size: 20px;
        font-weight: 900;
        color: var(--primary);
        text-transform: uppercase;
        display: block;
        padding-right: 15px; /* Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ù…Ø³Ø§ÙØ© Ø¬Ù…Ø§Ù„ÙŠØ© */
    }
    /* ------------------------------------------------------------------- */

    .asset-image-wrapper {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      aspect-ratio: 4/3;
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    /* (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª Ù„Ù… ØªØªØºÙŠØ±) */
    /* ... */
    
  </style>
</head>
<body>
  <div class="container">
    <div class="header-card">
      <div class="combined-logo-wrapper">
        <img src="https://i.ibb.co/ZR4bYj5C/21451b26-6e0c-42d0-b0f5-ee9b71771b3a-removalai-preview.png" alt="Ø´Ø¹Ø§Ø± Premiere Casing Services Ùˆ JAM Maintenance Team">
      </div>
    </div>

    <div id="loadingState" class="state-box">
      <div class="loader"></div>
      <div class="state-text">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù† Google Sheets...</div>
    </div>

    <div id="errorState" class="state-box" style="display: none;">
      <div class="error-icon">âš ï¸</div>
      <div class="state-text" id="errorMessage"></div>
    </div>

    <div id="mainContent" class="content-grid" style="display: none;">
      <div class="main-panel">
        <div class="asset-header">
          <h2 class="asset-title" id="assetTitle">--</h2> 
          <div class="status-badge green" id="statusBadge">--</div>
        </div>

        <div class="meta-grid">
          <div class="meta-card">
            <div class="meta-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
            <div class="meta-value" id="metaLocation">--</div>
          </div>
          <div class="meta-card">
            <div class="meta-label">Ø¢Ø®Ø± ÙØ­Øµ</div>
            <div class="meta-value" id="metaLast">--</div>
          </div>
          </div>

        <h3 class="section-title">Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div class="components-grid" id="componentsArea"></div>

        <div id="detailsSection" style="display: none;">
          <h3 class="section-title">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</h3>
          <div class="details-table" id="detailsTable"></div>
        </div>
      </div>

      <aside class="sidebar">
        <div class="image-card">
          <div class="device-units-box" id="deviceUnitsBox">
            </div>

          <div class="asset-image-wrapper" id="imageWrapper">
            <img class="asset-image" id="assetImage" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²" style="display: none;" />
            <div class="image-placeholder" id="imagePlaceholder">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</div>
          </div>
        </div>
        
        <div class="actions-card">
            <div class="actions-grid">
                <button class="action-btn primary" id="btnChecklist">
                ğŸ“‹ Ø¹Ø±Ø¶ Checklist
                </button>
                <button class="action-btn success" id="btnRigSite">
                ğŸ—ï¸ Ø¹Ø±Ø¶ Rig Site
                </button>
                <a class="action-btn danger" id="btnVideo" href="#" target="_blank" style="display: none;">
                â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                </a>
            </div>
        </div>
      </aside>
    </div>

    <div class="footer">
      JAM Inspection System for JAM devices monitoring & tracking. Developed by JAM Maintenance Team.
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
      <img class="modal-image" id="modalImage" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©" />
    </div>
  </div>

  <script>
    // âš ï¸ Configuration - ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø±Ø§Ø¨Ø· OpenSheet Ø§Ù„ØµØ­ÙŠØ­ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    const SHEET_JSON = "https://opensheet.elk.sh/1zO6S4g2aCpZ4CXrpkXNWn_Aifmhozo-mwOr3CGH5rpc/Sheet1";
    
    // Get query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const queryId = urlParams.get('id') || urlParams.get('unit') || urlParams.get('Unit');

    // Utility functions
    
    /** ÙŠØ³ØªØ±Ø¬Ø¹ Ù‚ÙŠÙ…Ø© Ø­Ù‚Ù„ Ù…Ù† Ø§Ù„ØµÙ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØ§ØªÙŠØ­ Ø¨Ø¯ÙŠÙ„Ø© */
    function safeGet(obj, keys) {
      for (const k of keys) {
        const val = obj[k];
        if (val !== null && val !== undefined && String(val).trim() !== '') {
          return String(val).trim();
        }
      }
      return null;
    }
    
    /** ÙŠØµÙ†Ù Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ (green, yellow, red) */
    function classifyStatus(text) {
      // (Ø¯Ø§Ù„Ø© ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù… ØªØªØºÙŠØ±)
      if (!text) return { cls: 'yellow', txt: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' };
      
      const t = String(text).toLowerCase().trim();
      
      if (t.match(/^(good|ok|yes|ready|green|true|working|operational|Ø¬ÙŠØ¯|Ø¬Ø§Ù‡Ø²|Ù†Ø¹Ù…|ÙŠØ¹Ù…Ù„)$/i) || t.includes('good') || t.includes('ok') || t.includes('Ø¬ÙŠØ¯') || t.includes('Ø¬Ø§Ù‡Ø²')) {
        return { cls: 'green', txt: text };
      }
      
      if (t.match(/^(fault|faulty|bad|no|fail|damag|error|red|broken|down|ØªØ§Ù„Ù|Ø®Ø·Ø£|Ù„Ø§|Ù…Ø¹Ø·Ù„)$/i) || t.includes('fault') || t.includes('bad') || t.includes('fail') || t.includes('ØªØ§Ù„Ù')) {
        return { cls: 'red', txt: text };
      }
      
      if (t.match(/^(warn|needs|check|pending|yellow|attention|ØªØ­Ø°ÙŠØ±|ÙŠØ­ØªØ§Ø¬|ÙØ­Øµ)$/i) || t.includes('warn') || t.includes('check') || t.includes('ØªØ­Ø°ÙŠØ±')) {
        return { cls: 'yellow', txt: text };
      }
      
      return { cls: 'yellow', txt: text };
    }

    /** ÙŠØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */
    function showError(message) {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('mainContent').style.display = 'none';
      document.getElementById('errorState').style.display = 'flex';
      document.getElementById('errorMessage').textContent = message;
    }

    /** ÙŠÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„ØµÙˆØ±Ø© */
    function openModal(url) {
      if (!url) return;
      const modal = document.getElementById('modal');
      const img = document.getElementById('modalImage');
      img.src = url;
      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    /** ÙŠØºÙ„Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.remove('open');
      document.body.style.overflow = '';
      setTimeout(() => {
        document.getElementById('modalImage').src = '';
      }, 300);
    }
    
    // Modal event listeners (Ù„Ù… ØªØªØºÙŠØ±)
    document.getElementById('modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeModal();
    });

    document.getElementById('modalClose').addEventListener('click', closeModal);

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    // Fetch and display data
    fetch(SHEET_JSON)
      .then(response => {
        if (!response.ok) {
          throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Google Sheets. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„.');
        }
        return response.json();
      })
      .then(rows => {
        if (!rows || rows.length === 0) {
          throw new Error('Ø§Ù„Ø´ÙŠØª ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
        }

        // Find the asset
        let asset = null;
        const idKeys = ['Unit', 'unit', 'UNIT', 'AssetID', 'Asset ID', 'ID', 'id'];
        
        if (queryId) {
          asset = rows.find(row => {
            return idKeys.some(key => String(row[key] || '').trim() === queryId);
          });
        } else {
          asset = rows[0];
        }

        if (!asset) {
          throw new Error(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ø±Ù‚Ù…: ${queryId || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ù„Ø´ÙŠØª.`);
        }

        // Extract data
        const unit = safeGet(asset, idKeys) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        
        // âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù„Ù„Ø¹Ù†ÙˆØ§Ù†)
        const deviceType = safeGet(asset, ['Name', 'name', 'System', 'system']) || 'Ø¬Ù‡Ø§Ø²'; 
        
        const photo = safeGet(asset, ['ImageURL', 'Image Url', 'Image', 'Photo', 'image']);
        const checklist = safeGet(asset, ['Checklist', 'ChecklistURL', 'Checklist URL', 'Checklist Image']);
        const rigsite = safeGet(asset, ['RigSite', 'Rig Site', 'RigSiteURL', 'Rig Site Image']);
        const video = safeGet(asset, ['VideoLink', 'Video Link', 'Video', 'video', 'VideoURL']);
        const ready = safeGet(asset, ['Ready', 'Status', 'State', 'status']) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const location = safeGet(asset, ['Location', 'Site', 'location']) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const lastCheck = safeGet(asset, ['LastInspection', 'Last Check', 'Last Checked', 'LastCheck', 'Last Inspection']) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        // âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© (Ù„Ù„Ø¹Ø±Ø¶ ØªØ­Øª Ø§Ù„ØµÙˆØ±Ø©)
        const wincattUnit = safeGet(asset, ['Wincatt Unit', 'Wincatt Name', 'Wincatt', 'WINCATT']);
        const mttUnit = safeGet(asset, ['MTT Unit', 'MTT Name', 'MTT']);
        const atexUnit = safeGet(asset, ['Atex Unit', 'Atex Name', 'Atex', 'ATEX']);
        
        // Display UI
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('mainContent').style.display = 'grid';

        // âœ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: [Name] (Unit ID)
        document.getElementById('assetTitle').textContent = `${deviceType} (${unit})`;
        
        const statusInfo = classifyStatus(ready);
        const statusBadge = document.getElementById('statusBadge');
        statusBadge.className = `status-badge ${statusInfo.cls}`;
        statusBadge.textContent = statusInfo.txt;

        // Set meta info (ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø© Ù…Ù† Ù‡Ù†Ø§)
        document.getElementById('metaLocation').textContent = location;
        document.getElementById('metaLast').textContent = lastCheck;
        
        // âœ… Ø¹Ø±Ø¶ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (ØªØ­Øª Ø§Ù„ØµÙˆØ±Ø©)
        const deviceUnitsBox = document.getElementById('deviceUnitsBox');
        deviceUnitsBox.innerHTML = '';
        
        // Ù†Ø³ØªØ®Ø¯Ù… Ù‚Ø§Ø¦Ù…Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù‚ÙŠÙ…Ø©
        const devices = [
            { label: 'Wincatt', value: wincattUnit, keys: ['Wincatt Unit', 'Wincatt Name', 'Wincatt', 'WINCATT'] },
            { label: 'MTT', value: mttUnit, keys: ['MTT Unit', 'MTT Name', 'MTT'] },
            { label: 'ATEX', value: atexUnit, keys: ['Atex Unit', 'Atex Name', 'Atex', 'ATEX'] } // Ù‡Ø°Ø§ Ù‡Ùˆ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù…Ø­Ø¯Ø¯
        ];

        let deviceFound = false;
        devices.forEach(device => {
            if (device.value) {
                deviceFound = true;
                const group = document.createElement('div');
                group.className = 'device-unit-group';
                
                const label = document.createElement('p');
                label.className = 'unit-label';
                label.textContent = device.label; // ATEX
                
                const value = document.createElement('span');
                value.className = 'unit-value';
                value.textContent = device.value; // 121696
                
                group.appendChild(label);
                group.appendChild(value);
                deviceUnitsBox.appendChild(group);
            }
        });
        
        if (!deviceFound) {
            deviceUnitsBox.style.display = 'none';
        }


        // Set image (Ù„Ù… ØªØªØºÙŠØ±)
        const img = document.getElementById('assetImage');
        const placeholder = document.getElementById('imagePlaceholder');
        const imgWrapper = document.getElementById('imageWrapper');
        
        if (photo) {
          img.src = photo;
          img.style.display = 'block';
          placeholder.style.display = 'none';
          imgWrapper.style.cursor = 'pointer';
          
          img.onerror = () => {
            img.style.display = 'none';
            placeholder.style.display = 'flex';
            imgWrapper.style.cursor = 'default';
          };

          imgWrapper.addEventListener('click', () => {
            if (img.src && img.style.display !== 'none') openModal(photo);
          });
        }

        // Find components (Ù„Ù… ÙŠØªØºÙŠØ±)
        const componentKeys = ['Loadcell', 'Load Cell', 'Encoder', 'DumpValve', 'Dump Valve', 'Controller', 'PowerSupply', 'Power Supply', 'Cables', 'Cable', 'System', 'Valve', 'Sensor', 'Pump'];
        const components = [];
        const usedKeys = new Set();
        // ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const mainAssetKeys = ['Unit', 'System', 'Location', 'Status', 'Ready', 'LastInspection', 'ImageURL', 'Checklist', 'RigSite', 'VideoLink', 'Photo', 'ID', 'Name', 'Type', 'Wincatt Unit', 'MTT Unit', 'Atex Unit', 'Wincatt Name', 'MTT Name', 'Atex Name', 'Wincatt', 'MTT', 'Atex', 'WINCATT', 'ATEX']; 

        Object.keys(asset).forEach(key => {
          const keyLower = key.toLowerCase();
          const isComponent = componentKeys.some(comp => keyLower.includes(comp.toLowerCase()));
          const isMainKey = mainAssetKeys.some(mk => key.toLowerCase().includes(mk.toLowerCase()));
          
          if (isComponent && !isMainKey && !usedKeys.has(key)) {
            const val = asset[key];
            if (val !== null && val !== undefined && String(val).trim() !== '') {
              components.push({ name: key, value: val });
              usedKeys.add(key);
            }
          }
        });

        // Display components (Ù„Ù… ÙŠØªØºÙŠØ±)
        const componentsArea = document.getElementById('componentsArea');
        componentsArea.innerHTML = '';
        
        if (components.length > 0) {
          components.forEach(comp => {
            const card = document.createElement('div');
            card.className = 'component-card';
            
            const name = document.createElement('div');
            name.className = 'component-name';
            name.textContent = comp.name;
            
            const status = document.createElement('div');
            status.className = 'component-status';
            const statusInfo = classifyStatus(comp.value);
            status.classList.add(statusInfo.cls);
            status.textContent = statusInfo.txt;
            
            card.appendChild(name);
            card.appendChild(status);
            componentsArea.appendChild(card);
          });
        } else {
          componentsArea.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px 40px; color: var(--text-muted); font-style: italic;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ø£Ùˆ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª.</div>';
        }

        // Display details table (Ù„Ù… ÙŠØªØºÙŠØ±)
        const detailsTable = document.getElementById('detailsTable');
        const skipKeysList = mainAssetKeys; 
        let hasDetails = false;

        Object.keys(asset).forEach(key => {
          const keyLower = key.toLowerCase();
          const shouldSkip = skipKeysList.some(sk => keyLower.includes(sk.toLowerCase())) || 
                           components.some(c => c.name === key);
          
          if (shouldSkip) return;
          
          const val = asset[key];
          if (!val || String(val).trim() === '') return;

          hasDetails = true;
          const row = document.createElement('div');
          row.className = 'detail-row';

          const label = document.createElement('div');
          label.className = 'detail-label';
          label.textContent = key;

          const value = document.createElement('div');
          value.className = 'detail-value';

          const valStr = String(val);
          
          if (valStr.match(/\.(jpg|jpeg|png|gif|bmp|webp|tiff|svg)$/i)) {
            const link = document.createElement('a');
            link.href = '#';
            link.textContent = 'ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©';
            link.onclick = (e) => {
              e.preventDefault();
              openModal(valStr);
            };
            value.appendChild(link);
          }
          else if (valStr.startsWith('http')) {
            const link = document.createElement('a');
            link.href = valStr;
            link.target = '_blank';
            link.textContent = valStr.length > 50 ? valStr.substring(0, 50) + '...' : valStr;
            value.appendChild(link);
          }
          else {
            value.textContent = valStr;
          }

          row.appendChild(label);
          row.appendChild(value);
          detailsTable.appendChild(row);
        });

        if (hasDetails) {
          document.getElementById('detailsSection').style.display = 'block';
        }

        // Setup action buttons (Ù„Ù… ØªØªØºÙŠØ±)
        document.getElementById('btnChecklist').addEventListener('click', () => {
          if (!checklist) {
            alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Checklist ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            return;
          }
          openModal(checklist);
        });

        document.getElementById('btnRigSite').addEventListener('click', () => {
          if (!rigsite) {
            alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Rig Site ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            return;
          }
          openModal(rigsite);
        });

        const btnVideo = document.getElementById('btnVideo');
        if (video) {
          btnVideo.style.display = 'flex';
          btnVideo.href = video;
        }

      })
      .catch(error => {
        // Handle errors
        console.error('Error:', error);
        showError(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      });
  </script>
</body>
</html>
